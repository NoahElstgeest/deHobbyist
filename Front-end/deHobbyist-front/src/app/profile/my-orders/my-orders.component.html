<div class="container my-5" *ngIf="!loading; else loadingTpl">
  <h3 class="mb-4 text-brown">Mijn bestellingen</h3>

  <a routerLink="/profile" class="btn btn-outline-dark mb-3">
    ← Terug naar profiel
  </a>

  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
  <div *ngIf="!error && orders.length === 0" class="alert alert-info">U heeft nog geen bestellingen geplaatst.</div>

  <div *ngFor="let o of orders" class="card mb-3 shadow-sm border-0">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
        <div>
          <h5 class="card-title mb-1">Bestelling #{{ o.id }}</h5>
          <p class="text-muted mb-1">
            {{ o.createdAt | date:'medium' }} ·
            <span class="badge bg-secondary">{{ o.status }}</span>
          </p>
          <strong>Totaal:</strong> {{ o.totalAmount | currency:'EUR' }}
        </div>
        <button class="btn btn-outline-dark btn-sm" (click)="toggle(o.id)">
          {{ isExpanded(o.id) ? 'Verberg details' : 'Toon details' }}
        </button>
      </div>

      <div *ngIf="isExpanded(o.id)" class="mt-3">
        <div class="table-responsive">
          <table class="table table-sm align-middle">
            <thead>
            <tr>
              <th>Product</th>
              <th class="text-center">Aantal</th>
              <th class="text-end">Prijs</th>
              <th class="text-end">Subtotaal</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let item of o.orderItems || []">
              <td class="text-truncate product-cell" title="{{ item.product.name }}">{{ item.product.name }}</td>
              <td class="text-center">{{ item.quantity }}</td>
              <td class="text-end">{{ item.price | currency:'EUR' }}</td>
              <td class="text-end">{{ (item.quantity * item.price) | currency:'EUR' }}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="text-center my-5"><div class="spinner-border" role="status" aria-label="Laden"></div></div>
</ng-template>
